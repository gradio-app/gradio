{"version":3,"file":"Upload-29fdce3c.js","sources":["../../../../js/upload/src/Upload.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher, tick, getContext } from \"svelte\";\n\timport type { FileData } from \"./types\";\n\timport { blobToBase64, normalise_file } from \"./utils\";\n\timport { upload_files as default_upload_files } from \"@gradio/client\";\n\n\tconst upload_files =\n\t\tgetContext<typeof default_upload_files>(\"upload_files\") ??\n\t\tdefault_upload_files;\n\n\texport let filetype: string | null = null;\n\texport let include_file_metadata = true;\n\texport let dragging = false;\n\texport let boundedheight = true;\n\texport let center = true;\n\texport let flex = true;\n\texport let file_count = \"single\";\n\texport let disable_click = false;\n\texport let parse_to_data_url = true;\n\texport let root: string;\n\n\tlet hidden_upload: HTMLInputElement;\n\n\tconst dispatch = createEventDispatcher();\n\n\tfunction updateDragging(): void {\n\t\tdragging = !dragging;\n\t}\n\n\tfunction openFileUpload(): void {\n\t\tif (disable_click) return;\n\t\thidden_upload.value = \"\";\n\t\thidden_upload.click();\n\t}\n\n\tasync function handle_upload(file_data: FileData[]): Promise<void> {\n\t\tawait tick();\n\t\tlet files = (Array.isArray(file_data) ? file_data : [file_data]).map(\n\t\t\t(file_data) => file_data.blob!\n\t\t);\n\n\t\tawait upload_files(root, files).then(async (response) => {\n\t\t\tif (response.error) {\n\t\t\t\t(Array.isArray(file_data) ? file_data : [file_data]).forEach(\n\t\t\t\t\tasync (file_data, i) => {\n\t\t\t\t\t\tfile_data.data = await blobToBase64(file_data.blob!);\n\t\t\t\t\t\tfile_data.blob = undefined;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t(Array.isArray(file_data) ? file_data : [file_data]).forEach((f, i) => {\n\t\t\t\t\tif (response.files) {\n\t\t\t\t\t\tf.orig_name = f.name;\n\t\t\t\t\t\tf.name = response.files[i];\n\t\t\t\t\t\tf.is_file = true;\n\t\t\t\t\t\tf.blob = undefined;\n\t\t\t\t\t\tnormalise_file(f, root, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tdispatch(\"load\", file_count === \"single\" ? file_data[0] : file_data);\n\t}\n\n\tasync function loadFiles(files: FileList): Promise<void> {\n\t\tlet _files: File[] = Array.from(files);\n\t\tif (!files.length) {\n\t\t\treturn;\n\t\t}\n\t\tif (file_count === \"single\") {\n\t\t\t_files = [files[0]];\n\t\t}\n\t\tvar all_file_data: FileData[] = [];\n\t\t_files.forEach((f, i) => {\n\t\t\tall_file_data[i] = {\n\t\t\t\tname: f.name,\n\t\t\t\tsize: f.size,\n\t\t\t\tdata: \"\",\n\t\t\t\tblob: f\n\t\t\t};\n\t\t});\n\t\tawait handle_upload(all_file_data);\n\t}\n\n\tasync function loadFilesFromUpload(e: Event): Promise<void> {\n\t\tconst target = e.target as HTMLInputElement;\n\n\t\tif (!target.files) return;\n\t\tawait loadFiles(target.files);\n\t}\n\n\tasync function loadFilesFromDrop(e: DragEvent): Promise<void> {\n\t\tdragging = false;\n\t\tif (!e.dataTransfer?.files) return;\n\t\tawait loadFiles(e.dataTransfer.files);\n\t}\n</script>\n\n<!-- TODO: fix -->\n<!-- svelte-ignore a11y-click-events-have-key-events -->\n<!-- svelte-ignore a11y-no-static-element-interactions -->\n<div\n\tclass:center\n\tclass:boundedheight\n\tclass:flex\n\ton:drag|preventDefault|stopPropagation\n\ton:dragstart|preventDefault|stopPropagation\n\ton:dragend|preventDefault|stopPropagation\n\ton:dragover|preventDefault|stopPropagation\n\ton:dragenter|preventDefault|stopPropagation\n\ton:dragleave|preventDefault|stopPropagation\n\ton:drop|preventDefault|stopPropagation\n\ton:click={openFileUpload}\n\ton:drop={loadFilesFromDrop}\n\ton:dragenter={updateDragging}\n\ton:dragleave={updateDragging}\n>\n\t<slot />\n\t<input\n\t\ttype=\"file\"\n\t\tbind:this={hidden_upload}\n\t\ton:change={loadFilesFromUpload}\n\t\taccept={filetype}\n\t\tmultiple={file_count === \"multiple\" || undefined}\n\t\twebkitdirectory={file_count === \"directory\" || undefined}\n\t\tmozdirectory={file_count === \"directory\" || undefined}\n\t/>\n</div>\n\n<style>\n\tdiv {\n\t\tcursor: pointer;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\n\t.center {\n\t\ttext-align: center;\n\t}\n\t.flex {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\tinput {\n\t\tdisplay: none;\n\t}\n</style>\n"],"names":["ctx","insert_dev","target","div","anchor","append_dev","input","upload_files","getContext","default_upload_files","filetype","$$props","include_file_metadata","dragging","boundedheight","center","flex","file_count","disable_click","parse_to_data_url","root","hidden_upload","dispatch","createEventDispatcher","updateDragging","$$invalidate","openFileUpload","handle_upload","file_data","tick","files","response","i","blobToBase64","f","normalise_file","loadFiles","_files","all_file_data","loadFilesFromUpload","loadFilesFromDrop","$$value"],"mappings":"84BA0HUA,EAAQ,CAAA,CAAA,eACNA,EAAU,CAAA,IAAK,YAAc,+BACtBA,EAAU,CAAA,IAAK,aAAe,MAAS,uBAC1CA,EAAU,CAAA,IAAK,aAAe,MAAS,+SAxBvDC,GA0BKC,EAAAC,EAAAC,CAAA,wBATJC,EAQCF,EAAAG,CAAA,oCALWN,EAAmB,CAAA,EAAA,GAAA,GAAA,GAAA,EAAA,gSATrBA,EAAc,CAAA,EAAA,GAAA,GAAA,GAAA,EAAA,aACfA,EAAiB,CAAA,EAAA,GAAA,GAAA,GAAA,EAAA,kBACZA,EAAc,CAAA,EAAA,GAAA,GAAA,GAAA,EAAA,kBACdA,EAAc,CAAA,EAAA,GAAA,GAAA,GAAA,EAAA,+HAOnBA,EAAQ,CAAA,CAAA,oBACNA,EAAU,CAAA,IAAK,YAAc,+CACtBA,EAAU,CAAA,IAAK,aAAe,qDACjCA,EAAU,CAAA,IAAK,aAAe,0ZAvHvC,MAAAO,EACLC,EAAwC,cAAc,GACtDC,EAEU,GAAA,CAAA,SAAAC,EAA0B,IAAI,EAAAC,EAC9B,CAAA,sBAAAC,EAAwB,EAAI,EAAAD,EAC5B,CAAA,SAAAE,EAAW,EAAK,EAAAF,EAChB,CAAA,cAAAG,EAAgB,EAAI,EAAAH,EACpB,CAAA,OAAAI,EAAS,EAAI,EAAAJ,EACb,CAAA,KAAAK,EAAO,EAAI,EAAAL,EACX,CAAA,WAAAM,EAAa,QAAQ,EAAAN,EACrB,CAAA,cAAAO,EAAgB,EAAK,EAAAP,EACrB,CAAA,kBAAAQ,EAAoB,EAAI,EAAAR,GACxB,KAAAS,CAAY,EAAAT,EAEnBU,EAEE,MAAAC,EAAWC,aAERC,GAAc,CACtBC,EAAA,GAAAZ,GAAYA,CAAQ,WAGZa,GAAc,CAClBR,QACJG,EAAc,MAAQ,GAAEA,CAAA,EACxBA,EAAc,MAAK,GAGL,eAAAM,EAAcC,EAAqB,OAC3CC,EAAI,EACN,IAAAC,GAAS,MAAM,QAAQF,CAAS,EAAIA,EAAa,CAAAA,CAAS,GAAG,IAC/DA,GAAcA,EAAU,IAAK,EAGzB,MAAArB,EAAaa,EAAMU,CAAK,EAAE,WAAYC,GAAQ,CAC/CA,EAAS,OACX,MAAM,QAAQH,CAAS,EAAIA,EAAa,CAAAA,CAAS,GAAG,QAC7C,MAAAA,EAAWI,IAAC,CAClBJ,EAAU,KAAI,MAASK,EAAaL,EAAU,IAAK,EACnDA,EAAU,KAAO,UAIlB,MAAM,QAAQA,CAAS,EAAIA,EAAa,CAAAA,CAAS,GAAG,QAAS,CAAAM,EAAGF,IAAC,CAC7DD,EAAS,QACZG,EAAE,UAAYA,EAAE,KAChBA,EAAE,KAAOH,EAAS,MAAMC,CAAC,EACzBE,EAAE,QAAU,GACZA,EAAE,KAAO,OACTC,EAAeD,EAAGd,EAAM,IAAI,OAKhCE,EAAS,OAAQL,IAAe,SAAWW,EAAU,CAAC,EAAIA,CAAS,EAGrD,eAAAQ,EAAUN,EAAe,CACnC,IAAAO,EAAiB,MAAM,KAAKP,CAAK,EAChC,GAAAA,EAAM,OAGP,CAAAb,IAAe,WAClBoB,EAAM,CAAIP,EAAM,CAAC,CAAA,OAEdQ,EAAa,CAAA,EACjBD,EAAO,QAAS,CAAAH,EAAGF,IAAC,CACnBM,EAAcN,CAAC,EAAA,CACd,KAAME,EAAE,KACR,KAAMA,EAAE,KACR,KAAM,GACN,KAAMA,KAGF,MAAAP,EAAcW,CAAa,GAGnB,eAAAC,EAAoB,EAAQ,OACpCrC,EAAS,EAAE,OAEZA,EAAO,aACNkC,EAAUlC,EAAO,KAAK,EAGd,eAAAsC,EAAkB,EAAY,CAC5Cf,EAAA,GAAAZ,EAAW,EAAK,EACX,EAAE,cAAc,OACf,MAAAuB,EAAU,EAAE,aAAa,KAAK,6rBA0BzBf,EAAaoB"}