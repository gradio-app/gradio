{"version":3,"file":"index-6a761e4f.js","sources":["../../../../js/model3D/static/Model3D.svelte","../../../../js/model3D/static/StaticModel3d.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport type { FileData } from \"@gradio/upload\";\n\timport { BlockLabel, IconButton } from \"@gradio/atoms\";\n\timport { File, Download, Undo } from \"@gradio/icons\";\n\timport { add_new_model, reset_camera_position } from \"../shared/utils\";\n\timport { onMount } from \"svelte\";\n\timport * as BABYLON from \"babylonjs\";\n\timport * as BABYLON_LOADERS from \"babylonjs-loaders\";\n\timport type { I18nFormatter } from \"js/utils/src\";\n\n\texport let value: FileData | null;\n\texport let clear_color: [number, number, number, number] = [0, 0, 0, 0];\n\texport let label = \"\";\n\texport let show_label: boolean;\n\texport let i18n: I18nFormatter;\n\texport let zoom_speed = 1;\n\n\t// alpha, beta, radius\n\texport let camera_position: [number | null, number | null, number | null] = [\n\t\tnull,\n\t\tnull,\n\t\tnull\n\t];\n\n\tBABYLON_LOADERS.OBJFileLoader.IMPORT_VERTEX_COLORS = true;\n\n\tlet canvas: HTMLCanvasElement;\n\tlet scene: BABYLON.Scene;\n\tlet engine: BABYLON.Engine | null;\n\tlet mounted = false;\n\n\tonMount(() => {\n\t\tengine = new BABYLON.Engine(canvas, true);\n\t\twindow.addEventListener(\"resize\", () => {\n\t\t\tengine?.resize();\n\t\t});\n\t\tmounted = true;\n\t});\n\n\t$: ({ data, name } = value || {\n\t\tdata: undefined,\n\t\tname: undefined\n\t});\n\n\t$: canvas && mounted && data != null && name && dispose();\n\n\tfunction dispose(): void {\n\t\tif (scene && !scene.isDisposed) {\n\t\t\tscene.dispose();\n\t\t\tengine?.stopRenderLoop();\n\t\t\tengine?.dispose();\n\t\t\tengine = null;\n\t\t\tengine = new BABYLON.Engine(canvas, true);\n\t\t\twindow.addEventListener(\"resize\", () => {\n\t\t\t\tengine?.resize();\n\t\t\t});\n\t\t}\n\t\tif (engine !== null) {\n\t\t\tscene = add_new_model(\n\t\t\t\tcanvas,\n\t\t\t\tscene,\n\t\t\t\tengine,\n\t\t\t\tvalue,\n\t\t\t\tclear_color,\n\t\t\t\tcamera_position,\n\t\t\t\tzoom_speed\n\t\t\t);\n\t\t}\n\t}\n\n\tfunction handle_undo(): void {\n\t\treset_camera_position(scene, camera_position, zoom_speed);\n\t}\n</script>\n\n<BlockLabel\n\t{show_label}\n\tIcon={File}\n\tlabel={label || i18n(\"3D_model.3d_model\")}\n/>\n{#if value}\n\t<div class=\"model3D\">\n\t\t<div class=\"buttons\">\n\t\t\t<IconButton Icon={Undo} label=\"Undo\" on:click={() => handle_undo()} />\n\t\t\t<a\n\t\t\t\thref={value.data}\n\t\t\t\ttarget={window.__is_colab__ ? \"_blank\" : null}\n\t\t\t\tdownload={window.__is_colab__ ? null : value.orig_name || value.name}\n\t\t\t>\n\t\t\t\t<IconButton Icon={Download} label={i18n(\"common.download\")} />\n\t\t\t</a>\n\t\t</div>\n\n\t\t<canvas bind:this={canvas} />\n\t</div>\n{/if}\n\n<style>\n\t.model3D {\n\t\tdisplay: flex;\n\t\tposition: relative;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\tcanvas {\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t\tobject-fit: contain;\n\t\toverflow: hidden;\n\t}\n\t.buttons {\n\t\tdisplay: flex;\n\t\tposition: absolute;\n\t\ttop: var(--size-2);\n\t\tright: var(--size-2);\n\t\tjustify-content: flex-end;\n\t\tgap: var(--spacing-sm);\n\t\tz-index: var(--layer-5);\n\t}\n</style>\n","<script lang=\"ts\">\n\timport type { FileData } from \"@gradio/upload\";\n\timport { normalise_file } from \"@gradio/upload\";\n\timport Model3D from \"./Model3D.svelte\";\n\timport { BlockLabel, Block, Empty } from \"@gradio/atoms\";\n\timport { File } from \"@gradio/icons\";\n\n\timport { StatusTracker } from \"@gradio/statustracker\";\n\timport type { LoadingStatus } from \"@gradio/statustracker\";\n\timport type { Gradio } from \"@gradio/utils\";\n\n\texport let elem_id = \"\";\n\texport let elem_classes: string[] = [];\n\texport let visible = true;\n\texport let value: null | FileData = null;\n\texport let root: string;\n\texport let root_url: null | string;\n\texport let clear_color: [number, number, number, number];\n\texport let loading_status: LoadingStatus;\n\texport let label: string;\n\texport let show_label: boolean;\n\texport let container = true;\n\texport let scale: number | null = null;\n\texport let min_width: number | undefined = undefined;\n\texport let gradio: Gradio;\n\texport let height: number | undefined = undefined;\n\texport let zoom_speed = 1;\n\n\t// alpha, beta, radius\n\texport let camera_position: [number | null, number | null, number | null] = [\n\t\tnull,\n\t\tnull,\n\t\tnull\n\t];\n\n\tlet _value: null | FileData;\n\t$: _value = normalise_file(value, root, root_url);\n\n\tlet dragging = false;\n</script>\n\n<Block\n\t{visible}\n\tvariant={value === null ? \"dashed\" : \"solid\"}\n\tborder_mode={dragging ? \"focus\" : \"base\"}\n\tpadding={false}\n\t{elem_id}\n\t{elem_classes}\n\t{container}\n\t{scale}\n\t{min_width}\n\t{height}\n>\n\t<StatusTracker\n\t\tautoscroll={gradio.autoscroll}\n\t\ti18n={gradio.i18n}\n\t\t{...loading_status}\n\t/>\n\n\t{#if value}\n\t\t<Model3D\n\t\t\tvalue={_value}\n\t\t\ti18n={gradio.i18n}\n\t\t\t{clear_color}\n\t\t\t{label}\n\t\t\t{show_label}\n\t\t\t{camera_position}\n\t\t\t{zoom_speed}\n\t\t/>\n\t{:else}\n\t\t<!-- Not ideal but some bugs to work out before we can \n\t\t\t\t make this consistent with other components -->\n\n\t\t<BlockLabel {show_label} Icon={File} label={label || \"3D Model\"} />\n\n\t\t<Empty unpadded_box={true} size=\"large\"><File /></Empty>\n\t{/if}\n</Block>\n"],"names":["create_if_block","BABYLON_LOADERS.OBJFileLoader","BABYLON.Engine"],"mappings":"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"}