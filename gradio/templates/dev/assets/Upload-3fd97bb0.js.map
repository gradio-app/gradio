{"version":3,"file":"Upload-3fd97bb0.js","sources":["../../../../js/upload/src/Upload.svelte"],"sourcesContent":["<script lang=\"ts\">\n\timport { createEventDispatcher, tick, getContext } from \"svelte\";\n\timport type { FileData } from \"./types\";\n\timport { blobToBase64, normalise_file } from \"./utils\";\n\timport { upload_files as default_upload_files } from \"@gradio/client\";\n\n\tconst upload_files =\n\t\tgetContext<typeof default_upload_files>(\"upload_files\") ??\n\t\tdefault_upload_files;\n\n\texport let filetype: string | null = null;\n\texport let dragging = false;\n\texport let boundedheight = true;\n\texport let center = true;\n\texport let flex = true;\n\texport let file_count = \"single\";\n\texport let disable_click = false;\n\texport let root: string;\n\n\tlet hidden_upload: HTMLInputElement;\n\n\tconst dispatch = createEventDispatcher();\n\n\tfunction updateDragging(): void {\n\t\tdragging = !dragging;\n\t}\n\n\tfunction openFileUpload(): void {\n\t\tif (disable_click) return;\n\t\thidden_upload.value = \"\";\n\t\thidden_upload.click();\n\t}\n\n\tasync function handle_upload(file_data: FileData[]): Promise<void> {\n\t\tawait tick();\n\t\tlet files = (Array.isArray(file_data) ? file_data : [file_data]).map(\n\t\t\t(file_data) => file_data.blob!\n\t\t);\n\n\t\tawait upload_files(root, files).then(async (response) => {\n\t\t\tif (response.error) {\n\t\t\t\t(Array.isArray(file_data) ? file_data : [file_data]).forEach(\n\t\t\t\t\tasync (file_data, i) => {\n\t\t\t\t\t\tfile_data.data = await blobToBase64(file_data.blob!);\n\t\t\t\t\t\tfile_data.blob = undefined;\n\t\t\t\t\t}\n\t\t\t\t);\n\t\t\t} else {\n\t\t\t\t(Array.isArray(file_data) ? file_data : [file_data]).forEach((f, i) => {\n\t\t\t\t\tif (response.files) {\n\t\t\t\t\t\tf.orig_name = f.name;\n\t\t\t\t\t\tf.name = response.files[i];\n\t\t\t\t\t\tf.is_file = true;\n\t\t\t\t\t\tf.blob = undefined;\n\t\t\t\t\t\tnormalise_file(f, root, null);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t});\n\t\tdispatch(\"load\", file_count === \"single\" ? file_data[0] : file_data);\n\t}\n\n\tasync function loadFiles(files: FileList): Promise<void> {\n\t\tlet _files: File[] = Array.from(files);\n\t\tif (!files.length) {\n\t\t\treturn;\n\t\t}\n\t\tif (file_count === \"single\") {\n\t\t\t_files = [files[0]];\n\t\t}\n\t\tvar all_file_data: FileData[] = [];\n\t\t_files.forEach((f, i) => {\n\t\t\tall_file_data[i] = {\n\t\t\t\tname: f.name,\n\t\t\t\tsize: f.size,\n\t\t\t\tdata: \"\",\n\t\t\t\tblob: f\n\t\t\t};\n\t\t});\n\t\tawait handle_upload(all_file_data);\n\t}\n\n\tasync function loadFilesFromUpload(e: Event): Promise<void> {\n\t\tconst target = e.target as HTMLInputElement;\n\n\t\tif (!target.files) return;\n\t\tawait loadFiles(target.files);\n\t}\n\n\tasync function loadFilesFromDrop(e: DragEvent): Promise<void> {\n\t\tdragging = false;\n\t\tif (!e.dataTransfer?.files) return;\n\t\tawait loadFiles(e.dataTransfer.files);\n\t}\n</script>\n\n<!-- TODO: fix -->\n<!-- svelte-ignore a11y-click-events-have-key-events -->\n<!-- svelte-ignore a11y-no-static-element-interactions -->\n<div\n\tclass:center\n\tclass:boundedheight\n\tclass:flex\n\ton:drag|preventDefault|stopPropagation\n\ton:dragstart|preventDefault|stopPropagation\n\ton:dragend|preventDefault|stopPropagation\n\ton:dragover|preventDefault|stopPropagation\n\ton:dragenter|preventDefault|stopPropagation\n\ton:dragleave|preventDefault|stopPropagation\n\ton:drop|preventDefault|stopPropagation\n\ton:click={openFileUpload}\n\ton:drop={loadFilesFromDrop}\n\ton:dragenter={updateDragging}\n\ton:dragleave={updateDragging}\n>\n\t<slot />\n\t<input\n\t\ttype=\"file\"\n\t\tbind:this={hidden_upload}\n\t\ton:change={loadFilesFromUpload}\n\t\taccept={filetype}\n\t\tmultiple={file_count === \"multiple\" || undefined}\n\t\twebkitdirectory={file_count === \"directory\" || undefined}\n\t\tmozdirectory={file_count === \"directory\" || undefined}\n\t/>\n</div>\n\n<style>\n\tdiv {\n\t\tcursor: pointer;\n\t\twidth: var(--size-full);\n\t\theight: var(--size-full);\n\t}\n\n\t.center {\n\t\ttext-align: center;\n\t}\n\t.flex {\n\t\tdisplay: flex;\n\t\tjustify-content: center;\n\t\talign-items: center;\n\t}\n\n\tinput {\n\t\tdisplay: none;\n\t}\n</style>\n"],"names":["upload_files","default_upload_files"],"mappings":"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"}